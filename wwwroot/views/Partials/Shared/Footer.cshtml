@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>
@using Umbraco.Extensions
@using Umbraco.Cms.Core.Models
@{
    var settings = Umbraco.ContentAtRoot()?.FirstOrDefault(x => x.ContentType.Alias == "companySettings");
    if (settings == null) { return; }

    var companyName = settings.Value<string>("companyName") ?? "VTL Technology";
    var companyDesc = settings.Value<string>("companyDescription") ?? "";
    var websiteLogo = settings.Value<IEnumerable<IPublishedContent>>("websiteLogoDark")?.FirstOrDefault() 
                      ?? settings.Value<IEnumerable<IPublishedContent>>("websiteLogoLight")?.FirstOrDefault();

    var footerLinksName = settings.Value<string>("footerLinksName") ?? "Liên kết hữu ích";
    var contactUs = settings.Value<string>("contactUs") ?? "Liên hệ";
    var workingHours = settings.Value<string>("workingHours")?.Replace("\n", "<br />");
    var copyrightText = settings.Value<string>("copyright") ?? $"© {DateTime.Now.Year} VTL Technology";

    var facebook = settings.Value<IEnumerable<Link>>("facebookUrl")?.FirstOrDefault()?.Url;
    var youtube = settings.Value<IEnumerable<Link>>("youtubeUrl")?.FirstOrDefault()?.Url;
    var zalo = settings.Value<IEnumerable<Link>>("zaloUrl")?.FirstOrDefault()?.Url;
    var messenger = settings.Value<IEnumerable<Link>>("messengerUrl")?.FirstOrDefault()?.Url;

    var isIntranet = Context.Request.Host.Value.Contains("intranet");
    var links = settings.Value<IEnumerable<Link>>(isIntranet ? "intranetFooterLinks" : "footerLinks") ?? Enumerable.Empty<Link>();
}

<footer class="bg-[#0a0a0b] text-gray-300 py-20 border-t border-white/5 relative overflow-hidden">
    @* Decorative Glow *@
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-primary/5 rounded-full blur-[120px] pointer-events-none"></div>

    <div class="vtl-container relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-16">
            
            @* Cột 1: Thông tin công ty *@
            <div class="flex flex-col gap-6">
                <div class="flex items-center gap-3">
                    <div class="w-1 h-7 bg-primary rounded-full shadow-[0_0_15px_rgba(var(--color-primary-rgb),0.5)]"></div>
                    <h4 class="text-xl font-bold text-white tracking-tight uppercase">@companyName</h4>
                </div>
                
                @if (websiteLogo != null) {
                    <img src="@websiteLogo.Url()" alt="logo" class="h-10 w-auto object-contain brightness-0 invert opacity-80 hover:opacity-100 transition-opacity" />
                }
                
                <p class="text-sm leading-relaxed text-gray-400 max-w-sm">@companyDesc</p>
                
                <p class="text-xs text-gray-600 mt-4">@copyrightText</p>
            </div>

            @* Cột 2: Liên kết nhanh *@
            <div class="flex flex-col gap-8">
                <h4 class="text-sm font-bold text-white uppercase tracking-[0.2em] flex items-center gap-2">
                    <span class="w-2 h-2 bg-primary rounded-full"></span>
                    @footerLinksName
                </h4>
                
                @if (links.Any()) {
                    <ul class="grid grid-cols-1 gap-4">
                        @foreach (var link in links) {
                            <li>
                                <a href="@link.Url" target="@link.Target" class="group flex items-center gap-3 text-sm text-gray-400 hover:text-primary transition-all duration-300">
                                    <span class="w-1 h-1 rounded-full bg-primary scale-0 group-hover:scale-125 transition-transform duration-300"></span>
                                    <span class="group-hover:translate-x-1 transition-transform">@link.Name</span>
                                </a>
                            </li>
                        }
                    </ul>
                }
            </div>

            @* Cột 3: Liên hệ & QR *@
            <div class="flex flex-col gap-8">
                <h4 class="text-sm font-bold text-white uppercase tracking-[0.2em] flex items-center gap-2">
                    <span class="w-2 h-2 bg-primary rounded-full"></span>
                    @contactUs
                </h4>

                <div class="text-sm text-gray-400 leading-relaxed bg-white/[0.02] p-6 rounded-2xl border border-white/5 backdrop-blur-sm">
                    @Html.Raw(workingHours)
                </div>
                
                <div class="flex items-center gap-6">
                    <div class="bg-white p-2.5 rounded-2xl shadow-[0_0_25px_rgba(0,0,0,0.5)] shrink-0 transition-transform hover:scale-105 duration-500">
                        <img id="qrImageFooter" alt="QR" class="w-16 h-16" />
                    </div>

                    <div class="flex flex-wrap gap-3">
                        @renderSocialBtn(facebook, "facebook", "#1877F2")
                        @renderSocialBtn(youtube, "youtube", "#FF0000")
                        @renderSocialBtn(messenger, "messenger", "#00B2FF")
                        @if (!string.IsNullOrEmpty(zalo) && !isIntranet) {
                            <a href="@zalo" target="_blank" class="w-11 h-11 flex items-center justify-center rounded-xl bg-white/5 hover:bg-[#0068FF] text-white transition-all border border-white/10 hover:border-transparent">
                                <span class="font-bold text-[10px] tracking-tighter">ZALO</span>
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

@helper renderSocialBtn(string url, string type, string hoverBg) {
    if (!string.IsNullOrEmpty(url)) {
        <a href="@url" target="_blank" 
           class="w-11 h-11 flex items-center justify-center rounded-xl bg-white/5 text-white transition-all border border-white/10 hover:border-transparent"
           style="--hover-bg: @hoverBg"
           onmouseover="this.style.backgroundColor='@hoverBg'"
           onmouseout="this.style.backgroundColor=''">
            @if(type == "facebook"){ <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.505 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.44 2.89h-2.333v6.988C18.343 21.128 22 16.991 22 12z"/></svg> }
            @if(type == "youtube"){ <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg> }
            @if(type == "messenger"){ <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.04c-5.5 0-10 4.14-10 9.24 0 2.91 1.43 5.51 3.66 7.18.19.14.3.37.27.6l-.14 2.1c-.04.66.61 1.15 1.18.82l2.36-1.33c.18-.1.38-.13.59-.09 1.3.36 2.68.56 4.08.56 5.5 0 10-4.14 10-9.24s-4.5-9.24-10-9.24zm1.22 11.9l-2.07-2.22-4.04 2.22 4.44-4.72 2.11 2.22 3.99-2.22-4.43 4.72z"/></svg> }
        </a>
    }
}

<script>
    (function() {
        const qr = document.getElementById("qrImageFooter");
        if (qr) {
            qr.src = "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=" + encodeURIComponent(window.location.href);
        }
    })();
</script>