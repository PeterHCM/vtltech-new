@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>
@using Umbraco.Cms.Core.Models
@using Umbraco.Extensions

@{
    var settings = Umbraco.ContentAtRoot().FirstOrDefault(x => x.ContentType.Alias == "companySettings");
    if (settings == null) { return; }

    var logos = settings.Value<IEnumerable<IPublishedContent>>("clientLogo");
    var title = settings.Value<string>("clientTitle") ?? "Khách hàng tiêu biểu";
    var currentDomain = Context.Request.Host.Value;
    var isIntranet = currentDomain.Contains("intranet");
}

@if (logos != null && logos.Any() && !isIntranet)
{
    <section class="relative py-16 bg-white dark:bg-dark transition-colors duration-700 overflow-hidden">
        <div class="max-w-7xl mx-auto px-4">
            <h2 class="text-center mb-10">@title</h2>

            <div class="relative group">
                <!-- Gradient mờ hai bên -->
                <div class="pointer-events-none absolute inset-y-0 left-0 w-24 bg-gradient-to-r from-white dark:from-gray-900 to-transparent z-10"></div>
                <div class="pointer-events-none absolute inset-y-0 right-0 w-24 bg-gradient-to-l from-white dark:from-gray-900 to-transparent z-10"></div>

                <!-- Carousel -->
                <div id="clientLogoCarousel"
                     class="flex gap-12 overflow-x-auto scrollbar-hide snap-x snap-mandatory scroll-smooth px-6 md:px-8 transition-transform duration-700 ease-[cubic-bezier(0.22,1,0.36,1)]">
                    @foreach (var logo in logos)
                    {
                        <div class="min-w-[120px] md:min-w-[160px] flex-shrink-0 flex justify-center items-center snap-center">
                            <img src="@logo.Url()" alt="@logo.Name" title="@logo.Name" loading="lazy"
                                 class="h-12 md:h-16 w-auto object-contain grayscale hover:grayscale-0 opacity-80 hover:opacity-100 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] transform hover:scale-105 dark:brightness-90" />
                        </div>
                    }
                </div>

                <!-- Nút điều hướng -->
                <button type="button"
                        class="hidden md:flex absolute left-6 top-1/2 -translate-y-1/2 bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-700 p-2 rounded-full shadow transition z-20"
                        onclick="scrollClientCarousel(-1)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                         stroke="currentColor" class="w-5 h-5 text-gray-700 dark:text-gray-200">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                    </svg>
                </button>

                <button type="button"
                        class="hidden md:flex absolute right-6 top-1/2 -translate-y-1/2 bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-700 p-2 rounded-full shadow transition z-20"
                        onclick="scrollClientCarousel(1)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                         stroke="currentColor" class="w-5 h-5 text-gray-700 dark:text-gray-200">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const carousel = document.getElementById('clientLogoCarousel');
            let scrollStep = 0.6;
            let direction = 1;
            let autoScroll;

            const startAutoScroll = () => {
                autoScroll = setInterval(() => {
                    carousel.scrollLeft += scrollStep * direction;
                    if (carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth || carousel.scrollLeft <= 0) {
                        direction *= -1;
                    }
                }, 16); // ~60fps
            };

            const stopAutoScroll = () => clearInterval(autoScroll);

            // Bắt đầu auto scroll
            startAutoScroll();

            // Dừng khi hover
            carousel.addEventListener('mouseenter', stopAutoScroll);
            carousel.addEventListener('mouseleave', startAutoScroll);
        });

        // Cuộn bằng nút
        function scrollClientCarousel(direction) {
            const carousel = document.getElementById('clientLogoCarousel');
            const scrollAmount = carousel.offsetWidth * 0.8;
            carousel.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth'
            });
        }
    </script>

    <style>
        /* Ẩn scrollbar nhưng vẫn trượt được */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
}