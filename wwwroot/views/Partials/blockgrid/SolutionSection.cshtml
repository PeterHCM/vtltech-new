@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockGridItem>
@using Umbraco.Extensions
@using Umbraco.Cms.Core.Models.PublishedContent
@using Umbraco.Cms.Core.Models
@using Microsoft.AspNetCore.Html
@using System.Linq

@{
    // Các biến bạn đã cung cấp:
    var content = Model.Content;
    var title = content.Value<string>("title");
    var subTitle = content.Value<string>("subTitle");
    var description = content.Value<string>("description")?.Replace("\n", "<br />");
    
    // solutions là IEnumerable<IPublishedContent> chứa 6 liên kết/nội dung
    var solutions = content.Value<IEnumerable<IPublishedContent>>("links")?.ToList() ?? new List<IPublishedContent>();
    var colSpan = ((int?)Model.ColumnSpan).GetValueOrDefault(12);
    var rowSpan = ((int?)Model.RowSpan).GetValueOrDefault(1);
    var blockClass = $"col-span-12 row-span-12 sm:col-span-{colSpan} sm:row-span-{rowSpan}";
    // Hình ảnh Hero Image
    var originalImageUrl = content.Value<IEnumerable<IPublishedContent>>("image")?.FirstOrDefault()?.Url();
    var isSvg = originalImageUrl?.EndsWith(".svg", StringComparison.OrdinalIgnoreCase) ?? false;
    var heroImageUrl = originalImageUrl != null
                ? (isSvg ? originalImageUrl : $"{originalImageUrl}?width=400&quality=80&format=webp")
                : "/media/default/VTL_logo.svg";

    if (solutions.Count < 6)
    {
        <p class="text-red-500 p-4">Cảnh báo: Cần 6 mục trong trường 'solutions' để hiển thị bố cục đầy đủ.</p>
        return;
    }
}
                
<div class="@blockClass">
    <div class="block-wrapper py-10 px-4 md:px-10">
    <h2 class="text-center">@title</h2>
    <h4 class="text-secondary text-center">@subTitle</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
            <!-- Cột 1: 3 giải pháp đầu -->
            <div class="space-y-6">
                @for (int i = 0; i < 3; i++)
                {
                    var item = solutions[i];
                    var itemTitle = item.Value<string>("title");
                    var itemDescription = item.Value<string>("description");
                    var iconUrl = item.Value<IEnumerable<IPublishedContent>>("icon")?.FirstOrDefault()?.Url();
                    <a href="@item.Url()">
                        <div class="card shadow rounded-lg p-4 mt-4 hover:shadow-md transition">
                            <div class="flex items-center gap-3 mb-2">
                                @if (!string.IsNullOrEmpty(iconUrl))
                                {
                                    <img src="@iconUrl" alt="Icon @i" class="w-10 h-10 object-contain" />
                                }
                                <h3 class="text-lg font-semibold">@itemTitle</h3>
                            </div>
                            <p class="text-sm text-gray-600">@itemDescription</p>
                        </div>
                    </a>
                }
            </div>

            <!-- Cột 2: Hero Image + Mô tả (ẩn ảnh trên mobile) -->
            <div class="flex flex-col items-center text-center">
                <img src="@heroImageUrl" alt="Hero Image" class="w-40 h-40 object-contain mb-6 hidden1 md:block" />
                <p class="text-gray-600 leading-relaxed">@Html.Raw(description)</p>
            </div>

            <!-- Cột 3: 3 giải pháp còn lại -->
            <div class="space-y-6">
                @for (int i = 3; i < 6; i++)
                {
                    var item = solutions[i];
                    var itemTitle = item.Value<string>("title");
                    var itemDescription = item.Value<string>("description");
                    var iconUrl = item.Value<IEnumerable<IPublishedContent>>("icon")?.FirstOrDefault()?.Url();
                    <a href="@item.Url()">
                        <div class="card shadow rounded-lg p-4 mt-4 hover:shadow-md transition">
                            <div class="flex items-center gap-3 mb-2">
                                @if (!string.IsNullOrEmpty(iconUrl))
                                {
                                    <img src="@iconUrl" alt="Icon @i" class="w-10 h-10 object-contain" />
                                }
                                <h3 class="text-lg font-semibold">@itemTitle</h3>
                            </div>
                            <p class="text-sm text-gray-600">@itemDescription</p>
                        </div>
                    </a>
                }
            </div>
        </div>
    </div>
</div>