@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockGridItem>
@using Umbraco.Extensions
@using Umbraco.Cms.Core.Models.PublishedContent
@using System.Linq
@{
    var content = Model.Content;
    var title = content.Value<string>("title");
    var subTitle = content.Value<string>("subTitle");
    var description = content.Value<string>("description");
    var layout = content.Value<string>("layout")?.ToLowerInvariant() ?? "4";
    var hideClass = layout == "6" ? "hidden" : "";
    var textClass = layout == "6" ?"text-sm" :"";
    var items = content.Value<IEnumerable<IPublishedContent>>("links");
    var colSpan = ((int?)Model.ColumnSpan).GetValueOrDefault(12);
    var rowSpan = ((int?)Model.RowSpan).GetValueOrDefault(1);
    var blockClass = $"col-span-12 row-span-12 sm:col-span-{colSpan} sm:row-span-{rowSpan}";
    var gridClass = layout switch
    {
        "6" => "grid-cols-2 sm:grid-cols-3 md:grid-cols-6",
        "3" => "grid-cols-2 sm:grid-cols-3 md:grid-cols-3",
        _ => "grid-cols-2 sm:grid-cols-3 md:grid-cols-4"
    };
}

<div class="@blockClass">
    <div class="block-wrapper">
        @if (!string.IsNullOrWhiteSpace(title) || !string.IsNullOrWhiteSpace(description))
        {
            <div class="block-header mb-4">
                @if (!string.IsNullOrWhiteSpace(title)) { <h2 class="text-center">@title</h2> }
                @if (!string.IsNullOrWhiteSpace(subTitle)) { <h4 class="text-secondary text-center">@subTitle</h4> }
                @if (!string.IsNullOrWhiteSpace(description)) { <p>@description</p> }
            </div>
        }

        @if (items.Any())
        {
            <div class="@($"grid {gridClass} gap-6 py-8")">
                @foreach (var item in items)
                {
                    var itemTitle = item.Name;
                    var itemDesc = item.Value<string>("description");
                    var image = item.Value<IEnumerable<IPublishedContent>>("image")?.FirstOrDefault()?.Url();
                    var icon = item.Value<IEnumerable<IPublishedContent>>("icon")?.FirstOrDefault()?.Url();

                    var isSvg = image?.EndsWith(".svg", StringComparison.OrdinalIgnoreCase) ?? false;
                    var imageUrl = !string.IsNullOrEmpty(image)
                        ? (isSvg ? image : $"{image}?width=400&quality=80&format=webp")
                        : "/media/default/VTL_logo.svg";
                    var iconUrl = !string.IsNullOrEmpty(icon) ? icon : "/media/default/VTL_logo.svg";

                    <div class="card group flex flex-col justify-between">
                        <a href="@item.Url()" class="block h-full">
                            <div class="card-image relative">
                                <img src="@imageUrl" alt="@itemTitle" class="card-image" loading="lazy" />
                                <div class="absolute inset-0 bg-black bg-opacity-10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </div>

                            <div class="card-body flex flex-col justify-between">
                                <div class="flex items-center gap-2">
                                    <img src="@iconUrl" alt="Icon @itemTitle" class="w-6 h-6 object-contain @hideClass" loading="lazy" />
                                    <h3 class="text-base sm:text-lg font-semibold text-primary dark:text-white line-clamp-2">@itemTitle</h3>
                                </div>

                                @if (!string.IsNullOrWhiteSpace(itemDesc))
                                {
                                    <p class="line-clamp-3 @textClass" title="@itemDesc">@itemDesc</p>
                                }
                            </div>
                        </a>
                    </div>
                }
            </div>
        }
    </div>
</div>
