@inherits UmbracoViewPage<BlockGridItem>
@using Umbraco.Cms.Core.Models.Blocks
@using Umbraco.Cms.Core.Models
@using Umbraco.Extensions
@{
    var content = Model.Content;
    var columnSpan = ((int?)Model.ColumnSpan).GetValueOrDefault(12);
    var rowSpan = ((int?)Model.RowSpan).GetValueOrDefault(1);
    var title = content.Value<string>("title");
    var subTitle = content.Value<string>("subTitle");
    var links = content.Value<IEnumerable<IPublishedContent>>("links");
    var currentUrl = Context.Request.Path.ToString().ToLower();
}
<div class="col-span-12 lg:col-span-@columnSpan row-span-@rowSpan w-full">
    <aside class="bg-white dark:bg-gray-900 rounded-2xl shadow-md p-5 border border-gray-100 dark:border-gray-800 transition-all">
        <!-- Header -->
        <div class="text-center mb-5">
            @if (!string.IsNullOrWhiteSpace(title))
            {
                <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100">@title</h2>
            }
            @if (!string.IsNullOrWhiteSpace(subTitle))
            {
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">@subTitle</p>
            }
        </div>

        <!-- Nav Menu -->
        @if (links != null && links.Any())
        {
            <nav class="space-y-1">
                @foreach (var link in links)
                {                    
                    var linkTitle = string.IsNullOrEmpty(link.Value<string>("title")) 
                                    ? link.Name 
                                    : link.Value<string>("title");
                    var linkUrl = link.Url();
                    var icons = link.Value<IEnumerable<MediaWithCrops>>("icon");
                    var firstIconUrl = icons?.FirstOrDefault()?.Url();
                    var isActive = currentUrl.Equals(linkUrl, StringComparison.OrdinalIgnoreCase);
                    <div class="group">
                        <a href="@linkUrl"
                           class="flex items-center gap-3 px-3 py-2 transition-all duration-300 
                                  @(isActive ? "bg-primary text-white shadow-sm hover:text-secondary" : "hover:bg-primary hover:text-white")">
                            @if (!string.IsNullOrEmpty(firstIconUrl))
                            {
                                <img src="@firstIconUrl" alt="Icon" class="w-5 h-5 object-contain" />
                            }
                            else
                            {
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke-width="2" stroke="currentColor" class="w-5 h-5 opacity-80">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5v13.5H3.75z" />
                                </svg>
                            }
                            <span class="font-medium">@linkTitle</span>
                        </a>

                        @if (link.Children() != null && link.Children().Any())
                        {
                            <ul class="pl-8 mt-1 space-y-1 border-l border-gray-200 dark:border-gray-700">
                                @foreach (var child in link.Children())
                                {                                    
                                    var childTitle = string.IsNullOrEmpty(child.Value<string>("title")) 
                                                    ? child.Name 
                                                    : child.Value<string>("title");
                                    var childUrl = child.Url();
                                    var childIcons = child.Value<IEnumerable<MediaWithCrops>>("icon");
                                    var childIconUrl = childIcons?.FirstOrDefault()?.Url();
                                    var isChildActive = currentUrl.Equals(childUrl, StringComparison.OrdinalIgnoreCase);
                                    <li>
                                        <a href="@childUrl"
                                           class="flex items-center gap-2 px-3 py-1.5 text-sm transition-all duration-300
                                                  @(isChildActive 
                                                    ? "bg-primary text-white font-semibold" 
                                                    : "hover:bg-primary hover:text-white")">
                                            @if (!string.IsNullOrEmpty(childIconUrl))
                                            {
                                                <img src="@childIconUrl" alt="Icon" class="w-4 h-4 object-contain" />
                                            }
                                            else
                                            {
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                     stroke-width="1.5" stroke="currentColor" class="w-4 h-4 opacity-70">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                          d="M12 6v12m6-6H6" />
                                                </svg>
                                            }
                                            <span>@childTitle</span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        }
                    </div>
                }
            </nav>
        }
    </aside>
</div>