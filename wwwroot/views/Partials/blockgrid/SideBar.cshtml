@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockGridItem>
@using Umbraco.Extensions
@{
    var content = Model.Content;
    var title = content.Value<string>("title") ?? "";
    var subTitle = content.Value<string>("subTitle") ?? "";
    var links = content.Value<IEnumerable<IPublishedContent>>("links") ?? Enumerable.Empty<IPublishedContent>();
    var currentUrl = Context.Request.Path.ToString().ToLower().TrimEnd('/');
}

<div class="col-span-12 lg:col-span-@(Model.ColumnSpan) w-full">
    <aside class="bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 overflow-hidden">
        
        @if (!string.IsNullOrEmpty(title))
        {
            <div class="p-6 pb-2 border-b border-gray-50 dark:border-gray-800">
                <h2 class="text-xl font-bold text-orange-600 dark:text-orange-500">@title</h2>
                @if (!string.IsNullOrEmpty(subTitle))
                {
                    <p class="text-sm text-gray-400 mt-1 uppercase tracking-wider font-medium">@subTitle</p>
                }
            </div>
        }

        <nav class="p-3 space-y-2">
            @foreach (var link in links)
            {
                var linkUrl = (link.Url() ?? "").ToLower().TrimEnd('/');
                var linkTitle = link.Value<string>("title").IfNullOrWhiteSpace(link.Name);
                var icon = link.Value<IEnumerable<Umbraco.Cms.Core.Models.MediaWithCrops>>("icon")?.FirstOrDefault();
                
                var children = link.Children() ?? Enumerable.Empty<IPublishedContent>();
                var isActive = currentUrl == linkUrl || children.Any(c => c.Url().ToLower().TrimEnd('/') == currentUrl);

                <div class="space-y-1">
                    @* Menu Cha *@
                    <a href="@link.Url()"
                       class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 group
                              @(isActive ? "bg-blue-600 text-white shadow-md shadow-blue-200 dark:shadow-none" 
                                         : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800")">
                        
                        @if (icon != null)
                        {
                            <img src="@icon.Url()" class="w-6 h-6 object-contain @(isActive ? "brightness-0 invert" : "opacity-80 group-hover:opacity-100")" alt="icon" />
                        }
                        <span class="font-bold">@linkTitle</span>
                    </a>

                    @* Menu Con *@
                    @if (children.Any())
                    {
                        <ul class="mt-1 ml-4 border-l-2 border-gray-100 dark:border-gray-800 space-y-1">
                            @foreach (var child in children)
                            {
                                var childUrl = (child.Url() ?? "").ToLower().TrimEnd('/');
                                var childTitle = child.Value<string>("title").IfNullOrWhiteSpace(child.Name);
                                var isChildActive = currentUrl == childUrl;

                                <li>
                                    <a href="@child.Url()"
                                       class="block px-6 py-2.5 text-sm transition-all rounded-r-lg
                                              @(isChildActive 
                                                ? "text-blue-600 font-bold bg-blue-50 dark:bg-blue-900/20 border-l-2 border-blue-600 -ml-[2px]" 
                                                : "text-gray-500 dark:text-gray-400 hover:text-blue-600 hover:bg-gray-50 dark:hover:bg-gray-800")">
                                        @childTitle
                                    </a>
                                </li>
                            }
                        </ul>
                    }
                </div>
            }
        </nav>
    </aside>
</div>