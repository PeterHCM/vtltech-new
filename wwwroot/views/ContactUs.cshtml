@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>
@using Umbraco.Extensions
@using Umbraco.Cms.Core.Models
@using System.Globalization
@{
    Layout = "layout.cshtml";
    var settings = Umbraco.ContentAtRoot()
                    .FirstOrDefault(x => x.ContentType.Alias == "companySettings");
    
    var title = Model.Value<string>("title") ?? "Contact Us";
    var contactInfo = Model.Value<string>("contactInfo") ?? "Contact Information";
    var description = Model.Value<string>("description");
    var workingHours = Model.Value<string>("workingHours") ?? "Mon – Fri: 08:00 – 17:00";
    var mapEmbed = Model.Value<string>("mapEmbed");
    var mapTitle = Model.Value<string>("mapTitle") ?? "Our Location";
    var qrTitle = Model.Value<string>("qrTitle") ?? "Contact vCard";
    
    var companyName = settings?.Value<string>("companyName") ?? "VTL Technology Co., Ltd";
    var address = settings?.Value<string>("companyAddress");
    var email = settings?.Value<string>("companyEmail");
    var phone = settings?.Value<string>("companyNumber");
    
    var qrContent = Model.Value<IEnumerable<IPublishedContent>>("qrCode")?.FirstOrDefault()?.Url();
    var qrCodeUrl = qrContent ?? "/media/default/VTL_logo.svg";
    
    var zaloLink = settings?.Value<IEnumerable<Link>>("zaloUrl")?.FirstOrDefault()?.Url ?? "#";
    var zaloQrUrl = $"https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={zaloLink}";
}

@await Html.PartialAsync("Partials/Shared/banner", Model)

<section class="vtl-container py-16 md:py-24">
    @* 1. Header Section chuẩn VTL *@
    <div class="mb-16 animate-fade-in">
        <span class="vtl-section-subtitle">Get in touch</span>
        <h1 class="vtl-section-title">@title</h1>
        <div class="vtl-section-divider !mx-0"></div>
        @if (!string.IsNullOrWhiteSpace(description))
        {
            <div class="max-w-3xl text-gray-600 dark:text-gray-400 mt-6 leading-relaxed">
                @Html.Raw(description)
            </div>
        }
    </div>

    @* 2. Grid System: items-stretch để 2 cột cao bằng nhau *@
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-stretch">
        
        @* Cột trái: Thông tin liên hệ *@
        <div class="lg:col-span-5 h-full">
            <div class="vtl-block-adaptive h-full flex flex-col justify-between">
                <div>
                    <h2 class="vtl-heading text-lg mb-8">@contactInfo</h2>
                    
                    <div class="space-y-6">
                        <div>
                            <p class="text-primary font-bold uppercase tracking-tighter text-[10px] mb-1">Company Name</p>
                            <p class="text-xl font-bold text-gray-900 dark:text-white leading-tight">@companyName</p>
                        </div>

                        <div class="flex gap-4">
                            <div class="shrink-0 w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">@address</p>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <a href="tel:@phone" class="group flex items-center gap-4 p-3 rounded-xl border border-gray-100 dark:border-white/5 hover:border-primary transition-all">
                                <div class="shrink-0 w-10 h-10 rounded-lg bg-gray-50 dark:bg-white/5 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors">
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.518 4.554a1 1 0 01-.27 1.031l-1.908 1.908a16.001 16.001 0 006.586 6.586l1.908-1.908a1 1 0 011.031-.27l4.554 1.518a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.163 21 3 14.837 3 7V5z"/></svg>
                                </div>
                                <div>
                                    <span class="block text-[9px] font-bold text-gray-400 uppercase">Hotline</span>
                                    <span class="text-sm font-bold dark:text-white">@phone</span>
                                </div>
                            </a>

                            <a href="mailto:@email" class="group flex items-center gap-4 p-3 rounded-xl border border-gray-100 dark:border-white/5 hover:border-primary transition-all">
                                <div class="shrink-0 w-10 h-10 rounded-lg bg-gray-50 dark:bg-white/5 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors">
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l9 6 9-6M4 6h16a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
                                </div>
                                <div>
                                    <span class="block text-[9px] font-bold text-gray-400 uppercase">Email</span>
                                    <span class="text-sm font-bold dark:text-white">@email</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                @* QR Section chuẩn hóa *@
                <div class="mt-12 pt-8 border-t border-dashed border-gray-100 dark:border-white/5">
                    <div class="grid grid-cols-2 gap-8">
                        <div class="text-center group">
                            <p class="vtl-link font-bold text-[9px] uppercase mb-4 justify-center">@qrTitle</p>
                            <div class="relative inline-block p-2 bg-white rounded-2xl shadow-sm border border-gray-100">
                                <img src="@qrCodeUrl" alt="vCard" class="w-28 h-28 object-contain" />
                            </div>
                        </div>
                        <div class="text-center group">
                            <p class="vtl-link font-bold text-[9px] uppercase mb-4 justify-center">Zalo Official</p>
                            <a href="@zaloLink" target="_blank" class="relative inline-block p-2 bg-white rounded-2xl shadow-sm border border-gray-100 hover:border-primary transition-colors">
                                <img src="@zaloQrUrl" alt="Zalo QR" class="w-28 h-28 object-contain" />
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* Cột phải: Bản đồ *@
        <div class="lg:col-span-7 h-full">
            <div class="vtl-block-adaptive h-full flex flex-col !p-0 overflow-hidden">
                <div class="p-6 md:p-8 bg-white dark:bg-transparent shrink-0">
                    <h2 class="vtl-heading text-lg">@mapTitle</h2>
                </div>
                <div class="flex-grow min-h-[400px] grayscale hover:grayscale-0 transition-all duration-700">
                    @if (!string.IsNullOrWhiteSpace(mapEmbed))
                    {
                        @Html.Raw(mapEmbed.Replace("width=\"600\"", "width=\"100%\"").Replace("height=\"450\"", "height=\"100%\""))
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* Ép bản đồ iframe chiếm toàn bộ diện tích cột */
    iframe { width: 100% !important; height: 100% !important; border: 0; }
</style>