@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@inject Microsoft.AspNetCore.Mvc.ViewEngines.ICompositeViewEngine viewEngine

@{
    Layout = "layout.cshtml";
    var blocks = Model.Value<Umbraco.Cms.Core.Models.Blocks.BlockGridModel>("pageContent");
    var fallbackPartial = "Partials/blockgrid/Default";
}

@* 1. Banner luôn trải dài toàn màn hình (Full Width) *@
@await Html.PartialAsync("Partials/Shared/banner", Model)

@if (blocks?.Any() == true)
{
    @* 2. Wrapper chính sử dụng vtl-container để căn giữa 1440px *@
    <main class="vtl-container py-10 md:py-20 overflow-hidden">
        
        @* Hệ thống Grid 12 cột chuẩn Tailwind. 
           Lưu ý: Các Block bên trong nên có class 'col-span-12' hoặc tùy biến theo Model.ColumnSpan 
        *@
        <div class="grid grid-cols-12 gap-y-16 md:gap-y-24 gap-x-4 md:gap-x-8 items-start">
            
            @foreach (var block in blocks)
            {
                var alias = block.Content.ContentType.Alias;
                var partialPath = $"Partials/blockgrid/{alias}";
                
                // Kiểm tra xem có Partial riêng cho Block này không, nếu không dùng Default
                var viewResult = viewEngine.FindView(ViewContext, partialPath, isMainPage: false);
                var partialToRender = viewResult.Success ? partialPath : fallbackPartial;

                @* Render Block: 
                   Mỗi Block sẽ tự quyết định col-span của nó dựa trên cấu hình trong Umbraco Backoffice
                *@
                @await Html.PartialAsync(partialToRender, block)
            }
            
        </div>
    </main>
}
